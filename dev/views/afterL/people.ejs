<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>完善个人信息</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<!--[if lt IE 9]>
<link href="https://cdn.bootcss.com/bootstrap/2.0.4/css/bootstrap.min.css" rel="stylesheet">
<![endif]-->
<!--[if gte IE 9]><!-->
	<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="cropper/cropper.min.css"  rel="stylesheet">
<!--<![endif]-->
	<style>
	body{
        background:url('../img/014.jpg') no-repeat ;
        background-size:100%;
    }
    @media (max-width: 970px) {
        body{
            background-size:1000px 600px;
        }
    }
.container{
	width:100%;
	max-width:750px;
	margin:10% auto;
	min-height:600px;
	background:transparent;
	border:solid 2px #123;
	border-radius: 1em;
	padding:1em;
}
#back{
	margin:10px;
}
#textUpdate{
	margin:10px;
	margin-top:0;
}
#peopleHeadForm{
	margin-left:10px;
	margin-bottom: 2em;
	position:relative;
	display: none;
	background: transparent;
}
#avator{
	margin-right:0.5em;
	padding:2px;
}
#headUpdate{
}
#peopleHeadForm div{
	max-width:500px;
	max-height:400px;
}
#checkImg{
	width:100%;
	max-width:500px;
}
#headImg{
	margin:0 10px;
	width:200px;
	height:200px;
	display: inline-block;
	float:left;
	cursor: pointer;
}
#headImg:hover{
	opacity: 0.8;
}
#headImg img{
	width:100%;
	height:100%;
}
#brief{
	float: left;
	display: inline-block;
	height:230px;
	background: transparent;
	padding:10px;
	margin:10px;
	margin-top:0;
	border:solid 1px #666;
	border-radius: 0.4em;
}
#nickname{
	margin:5px;
	background: transparent;
	display: inline-block;
	font-size: 1.3em;
	border:solid 1px #777;	
	border-radius: 0.4em;
}
#introduce{
	border-radius: 0.5em;
	background: transparent;
	display:block;
	width:250px;
	height:120px;
}
#introduce{
	font-size:1.2em;
	display: block;
}
#intro{
	margin-left:10px;
	width:240px;
	border:solid 1px #444;
	border-radius: 0.5em;
	float: left;
	display: inline-block;
	padding:1em;
}
#intro div{
	padding:0.4em 0;
}
#sex,#hobby,#birthday{
	width:150px;
	border:solid 1px #777;	
	border-radius: 0.4em;
}


@media (max-width: 768px) {
  	#brief{
  		margin:10px;
		height:250px;
	}
}

@media (max-width: 450px) {
	.container{
		padding:0;
	}
	#introduce{
	display:block;
	width:220px;
	height:110px;
	}
	#textUpdate{
		margin-left:2em;
	}
}

	</style>	
</head>
<body>

<div class='container'>
		<div class="row">
		<div class="col-md-12">
		<button id='back' class="btn btn-default">返回主页</button>
		</div>
		</div>
	
		<div class="row">
		<div class="col-md-12">

		<form action="/peopleI" id='peopleHeadForm' method='post' enctype='multipart/form-data'>
		<p>更新头像:</p>
		<input type="file" class="btn btn-default" id='avator' name="avator">
		<button type='button' class="btn btn-success" id='headUpdate'>保存头像</button>
		<!-- <div><img src="" id='checkImg' name='avator'></div> -->
		</form>
		<!-- <button id='dataURL_test'>DATAURL-TEST</button> -->

		</div>
		</div>
		
		<div class="row">

		<div class="col-md-4">
		<div id='headImg'  class='ele' data-toggle="tooltip" data-placement="top" title="更新头像">
		<img src=<%= headImg%>>
		</div>
		</div>

		<div class="col-md-8">
		<div id='brief'>
		<username>(<%= username %>)</username>
		昵称：
		<input id='nickname' value=<%= nickname%>>
		<h3>个人简介:</h3>
		<textarea id='introduce'><%= introduce %></textarea>
		</div>
		</div>

		</div>

		<div class="row">
		<div class="col-md-8">
		<div id='intro'>
		<div>性别：<input id='sex' value=<%= sex%>></div>
		<div>爱好：<input id='hobby' value=<%= hobby%>></div>
		<div>生日：<input id='birthday' value=<%= birthday%>></div>
		<h4>邮箱：<%= e_mail%></h4>
		</div>
		</div>

		<div class=".col-md-4">
		<button id='textUpdate' class="btn btn-primary">更新</button>
		</div>
		</div>

</div>



<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/jquery/1.8.3/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/2.0.1/bootstrap.min.js"></script>
<![endif]-->
<!--[if gte IE 9]><!-->
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src='cropper/cropper.min.js'></script>
<!--<![endif]-->
<script src='/js/afterL/people.js'></script>
<script>
	var username = '<%=username%>';
	peopleRender(username);
	updateInitial(username);

	document.getElementById('avator').onchange = function(){
		var r = new FileReader();
		var f = document.getElementById('avator').files[0];
		console.log(document.getElementById('avator').files)
		console.log(document.getElementById('avator').files.length)
		r.readAsDataURL(f);
		r.onload = function(e){
			console.log(620)
			console.log(this.result);
			document.getElementById('checkImg').src=this.result;
			$('#checkImg').cropper({
  				aspectRatio: 1
			});
		}
	}




// document.getElementById('headUpdate').onclick = function(){
// 	//return a canvas element
// 	var canvas =  $('#checkImg').cropper('getCroppedCanvas', {
//   		width: 100,
//   		height: 100,
//   		fillColor: '#fff',
//   		imageSmoothingEnabled: false,
//   		imageSmoothingQuality: 'high',
// 	});
// 	convertCanvasToImage(canvas);
// }





document.getElementById('dataURL_test').onclick = function(){
var canvas =  $('#checkImg').cropper('getCroppedCanvas', {
  		width: 200,
  		height: 200,
  		fillColor: '#fff',
  		imageSmoothingEnabled: false,
  		imageSmoothingQuality: 'high',
	});
	convertCanvasToImage(canvas);
}
// Converts canvas to an image
function convertCanvasToImage(canvas) {
	console.log(canvas)
	// canvas.toBlob(function(blob){
	// 	console.log(blob);
	// 	console.log(typeof blob);
	// 	document.querySelector('#headImg img').src = blob;
	// 	var xhr = new XMLHttpRequest();
	// 	xhr.open('POST','/Blob_test',true);
	// 	xhr.send(blob);
	// 	xhr.onreadyStateChange = function(){

	// 	}
	// 	console.log(typeof e);
	// 	console.log(e)
	// 	var data = JSON.parse(e);
	// 	var dataURL = data.url;
	// 	console.log(data);
	// 	console.log(typeof data);
	// 	console.log(typeof dataURL)
	// 	document.querySelector('#headImg img').src = dataURL;
	// },'image/png');




	var canvas_dataURL =  canvas.toDataURL("image/png");
	console.log(canvas_dataURL);
	console.log(typeof canvas_dataURL);
	document.querySelector('#headImg img').src = canvas_dataURL;






	// var base64 = canvas_dataURL.substr(canvas_dataURL.indexOf('.')+1);
	// console.log('base64'+base64);
	// var binary = atob(base64);
	// console.log('binary'+binary);
	// var len = binary.length;
	// console.log('len'+len);
	// var buf = new Uint8Array(len);
	// for(var i=0;i<len;i++){
	// 	buf[i] = binary.charCodeAt(i);
	// }
	// console.log('buf'+buf);

	// $.post('/dataURL_test',,function(e){
	// 	console.log(typeof e);
	// 	console.log(e)
	// 	var data = JSON.parse(e);
	// 	var dataURL = data.url;
	// 	console.log(data);
	// 	console.log(typeof data);
	// 	console.log(typeof dataURL)
	// 	// document.querySelector('#headImg img').src = dataURL;
	// });

	// var image = new Image();
	// image.src = canvas_dataURL;
	// document.querySelector('.container').appendChild(image);
}





</script>
</body>
</html>